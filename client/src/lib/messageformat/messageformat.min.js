!function(t){function e(t,r,n){var o=t||"en";if(r)e.locale[o]=r;else{for(;o&&!e.locale.hasOwnProperty(o);)o=o.replace(/[-_]?[^-_]*$/,"");o||(o=t.replace(/[-_].*$/,""),e.loadLocale(o))}this.lc=o,this.globalName=n||"i18n"}"locale"in e||(e.locale={}),e.loadLocale=function(t){try{var r=require("path").join(__dirname,"locale",t+".js"),n=(""+require("fs").readFileSync(r)).match(/{[^]*}/);if(!n)throw"no function found in file '"+r+"'";e.locale[t]="function(n)"+n}catch(o){if("en"!=t)throw o.message="Locale "+t+" could not be loaded: "+o.message,o;e.locale[t]='function(n){return n===1?"one":"other"}'}},e.prototype.functions=function(){var t=[];for(var r in e.locale)e.locale.hasOwnProperty(r)&&t.push(JSON.stringify(r)+":"+e.locale[r].toString().trim());return"{lc:{"+t.join(",")+'},\nc:function(d,k){if(!d)throw new Error("MessageFormat: Data required for \'"+k+"\'.")},\nn:function(d,k,o){if(isNaN(d[k]))throw new Error("MessageFormat: \'"+k+"\' isn\'t a number.");return d[k]-(o||0)},\nv:function(d,k){'+this.globalName+".c(d,k);return d[k]},\np:function(d,k,o,l,p){"+this.globalName+".c(d,k);return d[k] in p?p[d[k]]:(k="+this.globalName+".lc[l](d[k]-o),k in p?p[k]:p.other)},\ns:function(d,k,p){"+this.globalName+".c(d,k);return d[k] in p?p[d[k]]:p.other}}"};var r=function(){function t(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function e(t,e,r,n,o,a){this.message=t,this.expected=e,this.found=r,this.offset=n,this.line=o,this.column=a,this.name="SyntaxError"}function r(t){function r(e){function r(e,r,n){var o,a;for(o=r;n>o;o++)a=t.charAt(o),"\n"===a?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}return zt!==e&&(zt>e&&(zt=0,Lt={line:1,column:1,seenCR:!1}),r(Lt,zt,e),zt=e),Lt}function n(t){Zt>Mt||(Mt>Zt&&(Zt=Mt,Bt=[]),Bt.push(t))}function o(n,o,a){function u(t){var e=1;for(t.sort(function(t,e){return t.description<e.description?-1:t.description>e.description?1:0});e<t.length;)t[e-1]===t[e]?t.splice(e,1):e++}function i(t,e){function r(t){function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(t){return"\\x0"+e(t)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(t){return"\\x"+e(t)}).replace(/[\u0180-\u0FFF]/g,function(t){return"\\u0"+e(t)}).replace(/[\u1080-\uFFFF]/g,function(t){return"\\u"+e(t)})}var n,o,a,u=new Array(t.length);for(a=0;a<t.length;a++)u[a]=t[a].description;return n=t.length>1?u.slice(0,-1).join(", ")+" or "+u[t.length-1]:u[0],o=e?'"'+r(e)+'"':"end of input","Expected "+n+" but "+o+" found."}var l=r(a),s=a<t.length?t.charAt(a):null;return null!==o&&u(o),new e(null!==n?n:i(o,s),o,s,a,l.line,l.column)}function a(){var t,e;return t=Mt,e=u(),e!==N&&(qt=t,e=P(e)),t=e}function u(){var t,e,r,n;if(t=Mt,e=g(),e!==N){for(r=[],n=i();n!==N;)r.push(n),n=i();r!==N?(qt=t,e=R(e,r),t=e):(Mt=t,t=S)}else Mt=t,t=S;return t}function i(){var e,r,o,a,u,i,s;return e=Mt,123===t.charCodeAt(Mt)?(r=O,Mt++):(r=N,0===Dt&&n($)),r!==N?(o=_(),o!==N?(a=l(),a!==N?(u=_(),u!==N?(125===t.charCodeAt(Mt)?(i=I,Mt++):(i=N,0===Dt&&n(J)),i!==N?(s=g(),s!==N?(qt=e,r=M(a,s),e=r):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S),e}function l(){var e,r,o,a,u;return e=Mt,r=y(),r!==N?(o=Mt,44===t.charCodeAt(Mt)?(a=z,Mt++):(a=N,0===Dt&&n(L)),a!==N?(u=s(),u!==N?(a=[a,u],o=a):(Mt=o,o=S)):(Mt=o,o=S),o===N&&(o=q),o!==N?(qt=e,r=Z(r,o),e=r):(Mt=e,e=S)):(Mt=e,e=S),e}function s(){var e,r,o,a,u,i,l,s;return e=Mt,r=_(),r!==N?(t.substr(Mt,6)===B?(o=B,Mt+=6):(o=N,0===Dt&&n(D)),o!==N?(a=_(),a!==N?(44===t.charCodeAt(Mt)?(u=z,Mt++):(u=N,0===Dt&&n(L)),u!==N?(i=_(),i!==N?(l=c(),l!==N?(s=_(),s!==N?(qt=e,r=T(o,l),e=r):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S),e===N&&(e=Mt,r=_(),r!==N?(t.substr(Mt,6)===U?(o=U,Mt+=6):(o=N,0===Dt&&n(G)),o!==N?(a=_(),a!==N?(44===t.charCodeAt(Mt)?(u=z,Mt++):(u=N,0===Dt&&n(L)),u!==N?(i=_(),i!==N?(l=p(),l!==N?(s=_(),s!==N?(qt=e,r=T(o,l),e=r):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)),e}function c(){var t,e;return t=Mt,e=f(),e!==N&&(qt=t,e=H(e)),t=e}function p(){var t,e;return t=Mt,e=m(),e!==N&&(qt=t,e=K(e)),t=e}function f(){var t,e,r,n;if(t=Mt,e=h(),e===N&&(e=q),e!==N){for(r=[],n=d();n!==N;)r.push(n),n=d();r!==N?(qt=t,e=Q(e,r),t=e):(Mt=t,t=S)}else Mt=t,t=S;return t}function h(){var e,r,o,a,u,i,l,s;return e=Mt,r=_(),r!==N?(t.substr(Mt,6)===V?(o=V,Mt+=6):(o=N,0===Dt&&n(W)),o!==N?(a=_(),a!==N?(58===t.charCodeAt(Mt)?(u=X,Mt++):(u=N,0===Dt&&n(Y)),u!==N?(i=_(),i!==N?(l=k(),l!==N?(s=_(),s!==N?(qt=e,r=tt(l),e=r):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S),e}function m(){var t,e,r;for(t=Mt,e=[],r=d();r!==N;)e.push(r),r=d();return e!==N&&(qt=t,e=et(e)),t=e}function d(){var e,r,o,a,i,l,s,c,p;return e=Mt,r=_(),r!==N?(o=v(),o!==N?(a=_(),a!==N?(123===t.charCodeAt(Mt)?(i=O,Mt++):(i=N,0===Dt&&n($)),i!==N?(l=_(),l!==N?(s=u(),s!==N?(c=_(),c!==N?(125===t.charCodeAt(Mt)?(p=I,Mt++):(p=N,0===Dt&&n(J)),p!==N?(qt=e,r=rt(o,s),e=r):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S),e}function v(){var e,r,o;return e=Mt,r=y(),r!==N&&(qt=e,r=nt(r)),e=r,e===N&&(e=Mt,61===t.charCodeAt(Mt)?(r=ot,Mt++):(r=N,0===Dt&&n(at)),r!==N?(o=k(),o!==N?(qt=e,r=tt(o),e=r):(Mt=e,e=S)):(Mt=e,e=S)),e}function g(){var t,e,r,n,o,a,u;if(t=Mt,e=_(),e!==N){for(r=[],n=Mt,o=_(),o!==N?(a=F(),a!==N?(u=_(),u!==N?(o=[o,a,u],n=o):(Mt=n,n=S)):(Mt=n,n=S)):(Mt=n,n=S);n!==N;)r.push(n),n=Mt,o=_(),o!==N?(a=F(),a!==N?(u=_(),u!==N?(o=[o,a,u],n=o):(Mt=n,n=S)):(Mt=n,n=S)):(Mt=n,n=S);r!==N?(qt=t,e=ut(e,r),t=e):(Mt=t,t=S)}else Mt=t,t=S;return t}function y(){var e,r,o,a,u;if(e=Mt,r=_(),r!==N)if(it.test(t.charAt(Mt))?(o=t.charAt(Mt),Mt++):(o=N,0===Dt&&n(lt)),o!==N){for(a=[],st.test(t.charAt(Mt))?(u=t.charAt(Mt),Mt++):(u=N,0===Dt&&n(ct));u!==N;)a.push(u),st.test(t.charAt(Mt))?(u=t.charAt(Mt),Mt++):(u=N,0===Dt&&n(ct));a!==N?(u=_(),u!==N?(qt=e,r=pt(o,a),e=r):(Mt=e,e=S)):(Mt=e,e=S)}else Mt=e,e=S;else Mt=e,e=S;return e}function F(){var t,e,r;if(t=Mt,e=[],r=A(),r!==N)for(;r!==N;)e.push(r),r=A();else e=S;return e!==N&&(qt=t,e=ft(e)),t=e}function A(){var e,r,o,a,u,i;return e=Mt,ht.test(t.charAt(Mt))?(r=t.charAt(Mt),Mt++):(r=N,0===Dt&&n(mt)),r!==N&&(qt=e,r=dt(r)),e=r,e===N&&(e=Mt,t.substr(Mt,2)===vt?(r=vt,Mt+=2):(r=N,0===Dt&&n(gt)),r!==N&&(qt=e,r=yt()),e=r,e===N&&(e=Mt,t.substr(Mt,2)===Ft?(r=Ft,Mt+=2):(r=N,0===Dt&&n(At)),r!==N&&(qt=e,r=kt()),e=r,e===N&&(e=Mt,t.substr(Mt,2)===xt?(r=xt,Mt+=2):(r=N,0===Dt&&n(_t)),r!==N&&(qt=e,r=wt()),e=r,e===N&&(e=Mt,t.substr(Mt,2)===bt?(r=bt,Mt+=2):(r=N,0===Dt&&n(Ct)),r!==N?(o=x(),o!==N?(a=x(),a!==N?(u=x(),u!==N?(i=x(),i!==N?(qt=e,r=Nt(o,a,u,i),e=r):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S)):(Mt=e,e=S))))),e}function k(){var e,r,o;if(e=Mt,r=[],jt.test(t.charAt(Mt))?(o=t.charAt(Mt),Mt++):(o=N,0===Dt&&n(Et)),o!==N)for(;o!==N;)r.push(o),jt.test(t.charAt(Mt))?(o=t.charAt(Mt),Mt++):(o=N,0===Dt&&n(Et));else r=S;return r!==N&&(qt=e,r=Pt(r)),e=r}function x(){var e;return St.test(t.charAt(Mt))?(e=t.charAt(Mt),Mt++):(e=N,0===Dt&&n(Rt)),e}function _(){var t,e,r;for(Dt++,t=Mt,e=[],r=w();r!==N;)e.push(r),r=w();return e!==N&&(qt=t,e=$t(e)),t=e,Dt--,t===N&&(e=N,0===Dt&&n(Ot)),t}function w(){var e;return It.test(t.charAt(Mt))?(e=t.charAt(Mt),Mt++):(e=N,0===Dt&&n(Jt)),e}var b,C=arguments.length>1?arguments[1]:{},N={},j={start:a},E=a,P=function(t){return{type:"program",program:t}},S=N,R=function(t,e){var r=[];t&&t.val&&r.push(t);for(var n in e)e.hasOwnProperty(n)&&r.push(e[n]);return{type:"messageFormatPattern",statements:r}},O="{",$={type:"literal",value:"{",description:'"{"'},I="}",J={type:"literal",value:"}",description:'"}"'},M=function(t,e){var r=[];return t&&r.push(t),e&&e.val&&r.push(e),{type:"messageFormatPatternRight",statements:r}},q=null,z=",",L={type:"literal",value:",",description:'","'},Z=function(t,e){var r={type:"messageFormatElement",argumentIndex:t};return e&&e.length?r.elementFormat=e[1]:r.output=!0,r},B="plural",D={type:"literal",value:"plural",description:'"plural"'},T=function(t,e){return{type:"elementFormat",key:t,val:e.val}},U="select",G={type:"literal",value:"select",description:'"select"'},H=function(t){return{type:"pluralStyle",val:t}},K=function(t){return{type:"selectStyle",val:t}},Q=function(t,e){var r={type:"pluralFormatPattern",pluralForms:e};return t?r.offset=t:r.offset=0,r},V="offset",W={type:"literal",value:"offset",description:'"offset"'},X=":",Y={type:"literal",value:":",description:'":"'},tt=function(t){return t},et=function(t){return{type:"selectFormatPattern",pluralForms:t}},rt=function(t,e){return{type:"pluralForms",key:t,val:e}},nt=function(t){return t},ot="=",at={type:"literal",value:"=",description:'"="'},ut=function(t,e){for(var r=[],n=0;n<e.length;++n)for(var o=0;o<e[n].length;++o)r.push(e[n][o]);return{type:"string",val:t+r.join("")}},it=/^[0-9a-zA-Z$_]/,lt={type:"class",value:"[0-9a-zA-Z$_]",description:"[0-9a-zA-Z$_]"},st=/^[^ \t\n\r,.+={}]/,ct={type:"class",value:"[^ \\t\\n\\r,.+={}]",description:"[^ \\t\\n\\r,.+={}]"},pt=function(t,e){return t+(e?e.join(""):"")},ft=function(t){return t.join("")},ht=/^[^{}\\\0-\x1F \t\n\r]/,mt={type:"class",value:"[^{}\\\\\\0-\\x1F \\t\\n\\r]",description:"[^{}\\\\\\0-\\x1F \\t\\n\\r]"},dt=function(t){return t},vt="\\#",gt={type:"literal",value:"\\#",description:'"\\\\#"'},yt=function(){return"\\#"},Ft="\\{",At={type:"literal",value:"\\{",description:'"\\\\{"'},kt=function(){return"{"},xt="\\}",_t={type:"literal",value:"\\}",description:'"\\\\}"'},wt=function(){return"}"},bt="\\u",Ct={type:"literal",value:"\\u",description:'"\\\\u"'},Nt=function(t,e,r,n){return String.fromCharCode(parseInt("0x"+t+e+r+n))},jt=/^[0-9]/,Et={type:"class",value:"[0-9]",description:"[0-9]"},Pt=function(t){return parseInt(t.join(""),10)},St=/^[0-9a-fA-F]/,Rt={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},Ot={type:"other",description:"whitespace"},$t=function(t){return t.join("")},It=/^[ \t\n\r]/,Jt={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},Mt=0,qt=0,zt=0,Lt={line:1,column:1,seenCR:!1},Zt=0,Bt=[],Dt=0;if("startRule"in C){if(!(C.startRule in j))throw new Error("Can't start parsing from rule \""+C.startRule+'".');E=j[C.startRule]}if(b=E(),b!==N&&Mt===t.length)return b;throw b!==N&&Mt<t.length&&n({type:"end",description:"end of input"}),o(null,Bt,Zt)}return t(e,Error),{SyntaxError:e,parse:r}}();e.prototype.parse=function(){return r.parse.apply(r,arguments)},e.prototype.precompile=function(t){function e(t){var e=JSON.parse(JSON.stringify(t));return e.pf_count++,e}function r(t,a){a=a||{keys:{},offset:{}};var u,i,l=[];switch(t.type){case"program":return r(t.program);case"messageFormatPattern":for(u=0;u<t.statements.length;++u)l.push(r(t.statements[u],a));return i=l.join("+")||'""',a.pf_count?i:"function(d){return "+i+"}";case"messageFormatPatternRight":for(u=0;u<t.statements.length;++u)l.push(r(t.statements[u],a));return l.join("+");case"messageFormatElement":return a.pf_count=a.pf_count||0,t.output?n.globalName+'.v(d,"'+t.argumentIndex+'")':(a.keys[a.pf_count]='"'+t.argumentIndex+'"',r(t.elementFormat,a));case"elementFormat":return"select"===t.key?n.globalName+".s(d,"+a.keys[a.pf_count]+","+r(t.val,a)+")":"plural"===t.key?(a.offset[a.pf_count||0]=t.val.offset||0,n.globalName+".p(d,"+a.keys[a.pf_count]+","+(a.offset[a.pf_count]||0)+',"'+n.lc+'",'+r(t.val,a)+")"):"";case"pluralFormatPattern":for(a.pf_count=a.pf_count||0,o=!0,u=0;u<t.pluralForms.length;++u)"other"===t.pluralForms[u].key&&(o=!1),l.push('"'+t.pluralForms[u].key+'":'+r(t.pluralForms[u].val,e(a)));if(o)throw new Error("No 'other' form found in pluralFormatPattern "+a.pf_count);return"{"+l.join(",")+"}";case"selectFormatPattern":for(a.pf_count=a.pf_count||0,a.offset[a.pf_count]=0,o=!0,u=0;u<t.pluralForms.length;++u)"other"===t.pluralForms[u].key&&(o=!1),l.push('"'+t.pluralForms[u].key+'":'+r(t.pluralForms[u].val,e(a)));if(o)throw new Error("No 'other' form found in selectFormatPattern "+a.pf_count);return"{"+l.join(",")+"}";case"string":if(i='"'+(t.val||"").replace(/\n/g,"\\n").replace(/"/g,'\\"')+'"',a.pf_count){var s=a.offset[a.pf_count-1];i=i.replace(/(^|[^\\])#/g,'$1"+'+n.globalName+".n(d,"+a.keys[a.pf_count-1]+(s?","+s:"")+')+"'),i=i.replace(/^""\+/,"").replace(/\+""$/,"")}return i;default:throw new Error("Bad AST type: "+t.type)}}var n=this,o=!1;return r(t)},e.prototype.compile=function(t){return new Function("this['"+this.globalName+"']="+this.functions()+";return "+this.precompile(this.parse(t)))()},e.prototype.precompileObject=function(t){var e=[];for(var r in t)e.push(JSON.stringify(r)+":"+this.precompile(this.parse(t[r])));return"{\n"+e.join(",\n")+"}"},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.MessageFormat=e):"function"==typeof define&&define.amd?define(function(){return e}):t.MessageFormat=e}(this);